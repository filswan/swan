### Prerequisite

- **lotus** https://docs.filecoin.io/get-started/lotus/installation/ (node is NOT necessarily to be synced)
- python3, pip

### Install requirements

At dir client, run

    pip install -r requirements.txt 

### Config

Edit config.toml

#### main

- **api_url, api_key & access_token:** acquire from swan -> my profile

#### sender

- **offline_mode:** not connect to Swan, generate files locally
- **output_dir:** dir to move files to, as static resources for downloading
- **download_url_prefix:** domain name and path to add before the file name
- **is_public:** task is public [true/false]
- **is_verified:** deals in this task are going to be sent as verified [true/false]
- **generate_md5:** generate md5 for miners to verify the integrity of files [true/false] (time-consuming)
- **wallet:** the wallet to send offline deals
- **max_price:** the max price per GiB for offline deal
- **epoch_interval_hours:** the length of hour the deals start after current time, the miner has to finish sealing
  within this time span

### Run

##### 1. Generate car file for offline deal and create a task on Swan

A metadata CSV file will be generated in the output path

    python3 swan_cli.py task --input input_file_dir --name task_name

**--input (Required):** the dir path containing all files in the task to be created, all files in this fold (not in
subforlders) will be used
<br>
**--name (Optional):** task name (default: random name)

Output Swan task CSV template
<br>
miner_id,deal_cid,file_source_url,md5,start_epoch

Output metadata CSV template
<br>
uid,source_file_name,source_file_path,source_file_md5,source_file_url,source_file_size,car_file_name,car_file_path,car_file_md5,car_file_url,car_file_size,deal_cid,data_cid,piece_cid,miner_id,start_epoch

##### 2. Send offline deal

Send offline deals to a miner, according to deal information in metadata CSV, generated by 1st operation

    python3 swan_cli.py deal --csv csv_path --miner miner_id

**--csv (Required):** path to the metadata CSV file
<br>
**--miner (Required):** miner id to send deals to

Input metadata CSV template
<br>
uid,source_file_name,source_file_path,source_file_md5,source_file_url,source_file_size,car_file_name,car_file_path,car_file_md5,car_file_url,car_file_size,deal_cid,data_cid,piece_cid,miner_id,start_epoch
<br>
**Required Fields:** source_file_size, car_file_url, data_cid, piece_cid

##### 3. Force update miner status

    python3 swan_cli.py miner --miner miner_id

**--miner (Required):** miner id to update on Swan