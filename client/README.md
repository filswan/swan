### Prerequisite

- lotus node
- python 3.7+ 
- pip

### Install python requirements

```
pip install -r requirements.txt 
```

### Config

In config.toml

```
[main]
api_key = ""
access_token = ""
api_url = "https://api.filswan.com"

[sender]
offline_mode = false
output_dir = "/tmp/tasks"
download_url_prefix = "http://download.com/download"
is_public = true
is_verified = true
generate_md5 = false
wallet = ""
max_price = "0"
epoch_interval_hours = 96
```

#### main
- **api_key**   Follow instuctions here https://nebulaai.medium.com/how-to-use-api-key-in-swan-a2ebdb005aa4
- **access_token** Follow instuctions here https://nebulaai.medium.com/how-to-use-api-key-in-swan-a2ebdb005aa4
- **api_url:** Default using "https://api.filswan.com"

#### sender

- **offline_mode:** Default true. Disconnect with filswan.com when it is set to true, you will not be able to create swan task, but you can still create CSV and car Fil for sending deals.
- **output_dir:** Out directery for saving generated cars
- **download_url_prefix:** Webserver hostname and path for external client download.
- **is_public:** task is public [true/false]
- **is_verified:** deals in this task are going to be sent as verified [true/false]
- **generate_md5:** generate md5 for each car file generated [true/false] (time-consuming)
- **wallet:** the wallet used for sent offline deals
- **max_price:** the max price per GiB/epoch for offline deal
- **start_epoch_hours:** start_epoch for deals in hours

### Run

##### 1. Generate car file for offline deal and create a task on Swan

A metadata CSV file will be generated in the output path

    python3 swan_cli.py task --input input_file_dir --name task_name

**--input (Required):** the dir path containing all files in the task to be created, all files in this fold (not in
subforlders) will be used
<br>
**--name (Optional):** task name (default: random name)

Output Swan task CSV template
<br>
miner_id,deal_cid,file_source_url,md5,start_epoch

Output metadata CSV template
<br>
uid,source_file_name,source_file_path,source_file_md5,source_file_url,source_file_size,car_file_name,car_file_path,car_file_md5,car_file_url,car_file_size,deal_cid,data_cid,piece_cid,miner_id,start_epoch

##### 2. Send offline deal

Send offline deals to a miner, according to deal information in metadata CSV, generated by 1st operation

    python3 swan_cli.py deal --csv csv_path --miner miner_id

**--csv (Required):** path to the metadata CSV file
<br>
**--miner (Required):** miner id to send deals to

Input metadata CSV template
<br>
uid,source_file_name,source_file_path,source_file_md5,source_file_url,source_file_size,car_file_name,car_file_path,car_file_md5,car_file_url,car_file_size,deal_cid,data_cid,piece_cid,miner_id,start_epoch
<br>
**Required Fields:** source_file_size, car_file_url, data_cid, piece_cid

##### 3. Force update miner status

    python3 swan_cli.py miner --miner miner_id

**--miner (Required):** miner id to update on Swan
